{% extends "Room/base.html" %}
{% block content %}

<script>
  function viewSign(mess){
    alert(mess);
  }
</script>

<div class="container">
  {% if room.id %}
    {% if room.final_grade %}
      <h1 class="" style="color: green">
        Room {{room.id}}</h1>
    {% else %}
      <h1 class="" style="color: red">
        Room {{room.id}}</h1>
    {% endif %}
  {% else %}
    <h1 class="" style="color: green">Room Viewer</h1>
  {% endif %}
  
  <ol>
    {% if room.id %} 
      <li>Room ID: {{room.id}}</li>
    {% endif %}

    <li>
      Room Contestant: {{room.student_id.username}}
      <ol>
        <li>Score: {{room.prev_grade}}</li>
        <li>Wanted Score: {{room.wanted_grade}}</li>
        <li>Updated Score: {{room.final_score}}</li>
      </ol>
    </li>
  
    <li>
      Room Mentor:
      <ul>
        {% for mentor in room_details %}
        <li>{{mentor.mentor_id.username}}</li>
        {% endfor %}
      </ul>
    </li>
  
    <li>
      Room Final Average Score: {{room.final_grade}}
    </li>
  </ol>
  
  <h4 class=""> Test, Submission and Score</h4>
  <table class="container table table-striped mt-3 text-center">
    <thead>
      <tr>
        <th scope="col">#ID</th>
        <th scope="col">Mentor</th>
        <th scope="col">Test</th>
        <th scope="col">Test Signature</th>
        <th scope="col">Submission</th>
        <th scope="col">Submission Signature</th>
        <th scope="col">Score</th>
        <th scope="col">Score Signature</th>
      </tr>
    </thead>

    <tbody class="overflow-auto">
      {% for test in room_details %}
      <tr>
        <th scope="row" class="col-1">{{ forloop.counter }}</th>
        <td class="col-2">{{ test.mentor_id.username }}</td>
        
        <!-- Test -->
        {% if test.exam_cid and test.mentor_signature %}
        <td class="col-2">
          <form method="POST">{% csrf_token %}
            <input type="hidden" name="download" value={{test.exam_cid}}></input>
            <input type="hidden" name="title" value={{test.id}}></input>
            <button type="submit" class="btn btn-success">View</button>
          </form>
        </td> 
        {% else %}
        <td class="col-2"> None </td>
        {% endif %}
        
        <!-- Test Sign -->
        {% if test.mentor_signature %}
        <td class="col-1">
          <button class="btn btn-success" onclick="viewSign('{{test.mentor_signature}}')">View</button>
        </td>
        {% else %}
        <td class="col-1">None</td>
        {% endif %}
        
        <!-- Submission -->
        {% if test.answer_cid and test.student_signature %}
        <td class="col-2">
          <form method="POST">{% csrf_token %}
            <input type="hidden" name="download" value={{test.answer_cid}}></input>
            <input type="hidden" name="title" value={{test.id}}></input>
            <button type="submit" class="btn btn-success">View</button>
          </form>
        </td> 
        {% else %}
        <td class="col-2"> None </td>
        {% endif %}
        
        <!-- Submission Sign -->
        {% if test.student_signature %}
        <td class="col-1">
          <button class="btn btn-success" onclick="viewSign('{{test.student_signature}}')">View</button>
        </td>
        {% else %}
          <td class="col-1">None</td>
        {% endif %}

        <!-- Score -->
        {% if test.grade and test.score_signature %}
        <td class="col-2"> {{test.grade}} </td> 
        {% else %}
        <td class="col-2"> None </td>
        {% endif %}

        <!-- Score Sign -->
        {% if test.score_signature %}
        <td class="col-1">
          <button class="btn btn-success" onclick="viewSign('{{test.score_signature}}')">View</button>
        </td>
        {% else %}
          <td class="col-1">None</td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}